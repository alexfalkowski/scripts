#!/usr/bin/env bash
# shellcheck disable=SC1010,SC1091,SC2154

set -eo pipefail

source "$(dirname "$0")"/lib/dirs.sh
readonly action=$1

case $action in
new)
  for dir in "${services[@]}"; do
    (cd "$dir" && update-service-dep "$2" "$3" "$4")
  done
  ;;

latest)
  for dir in "${services[@]}"; do
    (cd "$dir" && make latest)
  done
  ;;

purge)
  for dir in "${services[@]}"; do
    (cd "$dir" && make purge)
  done
  ;;

dep)
  for dir in "${services[@]}"; do
    (cd "$dir" && make dep)
  done
  ;;

bundler)
  for dir in "${services[@]}"; do
    (cd "$dir" && update-bundler "svc" "$2" "$3")
  done
  ;;

submodule)
  for dir in "${services[@]}"; do
    (cd "$dir" && update-submodule "$2" "$3")
  done
  ;;

ci)
  for dir in "${services[@]}"; do
    (cd "$dir" && update-ci)
  done
  ;;

done)
  for dir in "${services[@]}"; do
    (cd "$dir" && make done)
  done
  ;;
esac
