#!/usr/bin/env bash
# shellcheck disable=SC1010,SC1091,SC2154

set -eo pipefail

source "$(dirname "$0")"/lib/dirs.sh
readonly dirs=$1
readonly action=$2

case $dirs in
ruby)
  directories=("${ruby[@]}")
  ;;

go)
  directories=("${go[@]}")
  ;;

services)
  directories=("${services[@]}")
  ;;

all)
  directories=("${all[@]}")
  ;;

esac

case $action in
latest)
  for dir in "${directories[@]}"; do
    (cd "$dir" && make latest)
  done
  ;;

purge)
  for dir in "${directories[@]}"; do
    (cd "$dir" && make purge)
  done
  ;;

dep)
  for dir in "${directories[@]}"; do
    (cd "$dir" && make dep)
  done
  ;;

submodule)
  for dir in "${directories[@]}"; do
    (cd "$dir" && update-submodule "$3" "$4")
  done
  ;;

ci)
  for dir in "${directories[@]}"; do
    (cd "$dir" && update-ci)
  done
  ;;

bundler)
  for dir in "${directories[@]}"; do
    (cd "$dir" && update-bundler "$3" "$4")
  done
  ;;

done)
  for dir in "${directories[@]}"; do
    (cd "$dir" && make done)
  done
  ;;

esac
